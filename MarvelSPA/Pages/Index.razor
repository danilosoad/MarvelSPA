@page "/personagem"
@inject HttpClient _http;
@using System.Text.Json

<MudTextField @bind-Value="@nome" Label="Personagem" Variant="Variant.Text"></MudTextField>
<br />
<br />
<MudButton Variant="Variant.Filled" @onclick="BuscarPersonagem" Color="Color.Primary">Pesquisar</MudButton>
<MudOverlay @bind-Visible="isVisible" DarkBackground="true" AutoClose="true" />
<br />
<br />

<br />
<ImagemCard url="@imgPath" description="@resultado" name="@nome" />


@code{
    string teste;
    string resultado;
    string imgPath;
    string extension;
    string path;

    string nome = string.Empty;

    private async void BuscarPersonagem()
    {
        OpenOverlay();

        var url = $"https://gateway.marvel.com/v1/public/characters?name={nome}&apikey=d659481d3f02d81e5ec1b11d8f40a089&hash=f4cc18f4da2791ef5d1d06b6a8d5c7d0&ts=1637856513";

        var httpRequestMessage = new HttpRequestMessage()
        {
            Method = new HttpMethod("GET"),
            RequestUri = new Uri(url),
        };

        httpRequestMessage.Headers.Add("Accept", "*/*");

        var response = await _http.SendAsync(httpRequestMessage);

        var content = await response.Content.ReadAsStringAsync();

        var personagem = System.Text.Json.JsonSerializer.Deserialize<Resposta>(content);

        resultado = "there is no description for this character.";

        if (personagem.data.results.FirstOrDefault().description != "")
            resultado = personagem.data.results.FirstOrDefault().description;

        path = personagem.data.results.FirstOrDefault().thumbnail.path;
        extension = "." + personagem.data.results.FirstOrDefault().thumbnail.extension;

        imgPath = $"{path + extension}";
        nome = string.Empty;

        CloseOverlay();
    }

    private bool isVisible;

    public void OpenOverlay()
    {
        isVisible = true;
        StateHasChanged();
    }

    public void CloseOverlay()
    {
        isVisible = false;
        StateHasChanged();
    }

    //public void Enter(KeyboardEventArgs e)
    //{
    //    if (e.Code == "Enter" || e.Code == "NumpadEnter")
    //    {

    //        BuscarPersonagem();

    //        Console.WriteLine("apertou");
    //    }
    //}

}